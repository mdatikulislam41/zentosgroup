<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Secure Checkout</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/checkout.css" />
    <link rel="stylesheet" href="./assets/css/main.css" />
    <link rel="stylesheet" href="./assets/css/form.css" />
    <link rel="stylesheet" href="./assets/css/responsive.css" />
  </head>
  <body>
    <div class="container">
      <div class="checkout-header top_padding">
        <div class="top_item">
          <p class="trust-badge-top">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"
              />
            </svg>
            Trusted by 2000+ customers
          </p>
        </div>
        <div class="top_item"><h1>Secure Checkout</h1></div>
        <div class="top_item">
          <div class="payment-logos">
            <img src="./assets/images/payment/visa.svg" alt="" srcset="" />
            <img
              src="./assets/images/payment/card.svg"
              alt=""
              srcset=""
              width="32px"
              height="32px"
            />
          </div>
        </div>
      </div>
      <div class="ssl-bar top_padding">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="17"
          viewBox="0 0 14 17"
          fill="none"
        >
          <path
            d="M12 6.00004V5.00002C12 2.24315 9.75684 0 7 0C4.24316 0 2.00003 2.24315 2.00003 5.00002V6.00004C0.895466 6.00004 0 6.89541 0 8.00009V15.0001C0.000106249 16.1045 0.895466 17 2.00003 17H12C13.1045 17 14 16.1045 14 14.9999V7.99999C13.9999 6.89541 13.1045 6.00004 12 6.00004ZM4.00006 5.00002C4.00006 3.34571 5.3457 2.00005 7 2.00005C8.65429 2.00005 9.99994 3.34571 9.99994 5.00002V6.00004H4.00006V5.00002ZM7.99991 12C7.99991 12.5523 7.55217 13 6.99989 13C6.44761 13 5.99988 12.5523 5.99988 12V9.99993C5.99988 9.44764 6.44761 8.99991 6.99989 8.99991C7.55217 8.99991 7.99991 9.44764 7.99991 9.99993V12Z"
            fill="#FEFEFE"
          />
        </svg>
        <span>SSL Safe Payment</span>
      </div>
      <div class="progress-steps top_padding">
        <div class="step active">
          <span class="step-number">1</span> Shipping Details
        </div>
        <div class="step">
          <span class="step-number">2</span> Payment Method
        </div>
      </div>
    </div>
    <section class="container top_padding">
      <div class="payment_form">
        <!-- Left Column: Form -->
        <div class="form-section">
          <form action="">
            <div class="form-block">
              <div id="customerInformation">
                <h2>Shipping Details</h2>
                <div class="form-group">
                  <input
                    type="email"
                    id="email"
                    placeholder=" "
                    required=""
                    autocomplete="off"
                  />
                  <label for="email" class="input_label">E-mail</label>
                </div>

                <div class="row">
                  <div class="form-group">
                    <input type="text" id="fname" placeholder=" " required="" />
                    <label for="fname" class="input_label">First Name</label>
                  </div>

                  <div class="form-group">
                    <input type="text" id="lname" placeholder=" " required="" />
                    <label for="lname" class="input_label">Last Name</label>
                  </div>
                </div>

                <div class="form-group">
                  <input type="text" id="address" placeholder=" " required="" />
                  <label for="address" class="input_label">Address</label>
                </div>

                <div class="row">
                  <div class="form-group">
                    <input type="text" id="city" placeholder=" " required="" />
                    <label for="city" class="input_label">City</label>
                  </div>

                  <div class="form-group">
                    <input type="text" id="zip" placeholder=" " required="" />
                    <label for="zip" class="input_label">ZIP Code</label>
                  </div>
                </div>

                <!-- <div class="form-group">
                          <select id="country" required="">
                            <option value="" hidden=""></option>
                            <option value="Bulgaria" selected="">Bulgaria</option>
                            <option value="USA">USA</option>
                            <option value="UK">United Kingdom</option>
                            <option value="Germany">Germany</option>
                          </select>
                          <label for="country" class="input_label">Country</label>
                        </div> -->
                <div class="form-group">
                  <div id="country-select" class="custom-select">
                    <input
                      id="country-input"
                      type="search"
                      placeholder="Select country"
                      autocomplete="off"
                      class="select-display"
                      style="
                        width: 100%;
                        box-sizing: border-box;
                        padding: 12px;
                        border: 1px solid #e2e2e2;
                        border-radius: 8px;
                        background: #fff;
                      "
                    />
                    <div
                      id="country-panel"
                      class="select-panel"
                      style="position: relative"
                    >
                      <div
                        id="country-panel-inner"
                        style="
                          display: none;
                          position: absolute;
                          z-index: 20;
                          left: 0;
                          right: 0;
                          background: #fff;
                          border: 1px solid #e2e2e2;
                          border-radius: 8px;
                          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
                          margin-top: 6px;
                        "
                      >
                        <ul
                          id="country-list"
                          style="
                            list-style: none;
                            margin: 0;
                            padding: 6px 0;
                            max-height: 220px;
                            overflow: auto;
                          "
                        ></ul>
                      </div>
                    </div>
                  </div>
                  <select id="country" required style="display: none">
                    <option value="" hidden>Select country</option>
                  </select>
                  <label for="country" class="input_label">Country</label>
                </div>
                <div class="form-group" id="state-group" style="display: none">
                  <div id="state-select" class="custom-select">
                    <input
                      id="state-input"
                      type="search"
                      placeholder="Select state"
                      autocomplete="off"
                      class="select-display"
                      style="
                        width: 100%;
                        box-sizing: border-box;
                        padding: 12px;
                        border: 1px solid #e2e2e2;
                        border-radius: 8px;
                        background: #fff;
                      "
                    />
                    <div
                      id="state-panel"
                      class="select-panel"
                      style="position: relative"
                    >
                      <div
                        id="state-panel-inner"
                        style="
                          display: none;
                          position: absolute;
                          z-index: 20;
                          left: 0;
                          right: 0;
                          background: #fff;
                          border: 1px solid #e2e2e2;
                          border-radius: 8px;
                          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
                          margin-top: 6px;
                        "
                      >
                        <ul
                          id="state-list"
                          style="
                            list-style: none;
                            margin: 0;
                            padding: 6px 0;
                            max-height: 220px;
                            overflow: auto;
                          "
                        ></ul>
                      </div>
                    </div>
                  </div>
                  <select id="state" required style="display: none">
                    <option value="" hidden>Select state</option>
                  </select>
                  <label for="state" class="input_label">State</label>
                </div>
                <div class="row">
                  <div class="form-group one-third">
                    <select id="code" required="">
                      <option value="" hidden=""></option>
                      <option value="+359" selected="">(+359) Bulgaria</option>
                      <option value="+1">(+1) USA</option>
                      <option value="+44">(+44) UK</option>
                      <option value="+49">(+49) Germany</option>
                    </select>
                    <label for="code" class="input_label">Code</label>
                  </div>

                  <div class="form-group two-third">
                    <input type="tel" id="phone" placeholder=" " required="" />
                    <label for="phone" class="input_label">Phone Number</label>
                  </div>
                </div>
              </div>
              <!-- Payment Part -->
            </div>

            <div class="form-block">
              <h2>Shipping Options</h2>
              <div class="shipping-options-wrapper">
                <div class="shipping-option selected">
                  <div class="radio-check">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"
                      />
                    </svg>
                  </div>
                  <div class="shipping-details">
                    <p>Standard shipping</p>
                    <small>5+ Working days</small>
                  </div>
                  <div class="shipping-price">Free</div>
                </div>
                <div class="shipping-option">
                  <div class="radio-check">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"
                      />
                    </svg>
                  </div>
                  <div class="shipping-details">
                    <p>Faster shipping</p>
                    <small>3-5 Working days</small>
                  </div>
                  <div class="shipping-price">$9.99</div>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <div class="checkbox-group">
                <input type="checkbox" id="newsletter" />
                <label for="newsletter"
                  >Sign up for exclusive offers, news and communication
                  services.</label
                >
              </div>
              <button type="submit" class="continue-btn">Continue</button>
              <p class="disclaimer">
                By clicking "Continue", I confirm that I have read, consented
                to, and accepted the <a href="#">Terms & Conditions</a>, the
                <a href="#">Privacy Policy</a>, and that I am at least 18 years
                of age.
              </p>
            </div>
          </form>
        </div>

        <!-- Right Column: Cart Summary -->
        <div class="cart-summary">
          <div class="summary-box">
            <h3>Your Cart</h3>
            <div class="cart-item">
              <div class="item-image-wrapper">
                <img
                  src="./assets/images/product/product.png"
                  alt="Orange sneakers"
                />
                <span class="item-quantity">1</span>
              </div>
              <div class="item-details">
                <p class="item-name">Product name</p>
                <p class="item-stock">Only 3 left in stock</p>
              </div>
              <p class="item-price">$340.01</p>
            </div>
            <div class="price-breakdown">
              <div class="price-row">
                <span>Subtotal:</span>
                <span>$340.01</span>
              </div>
              <div class="price-row">
                <span>Shipping:</span>
                <span id="shipping-cost">$9.99</span>
              </div>
            </div>
            <div class="total-price">
              <span>Total:</span>
              <span class="total-amount" id="total-amount">$349.00</span>
            </div>
          </div>
          <div class="guarantee-box">
            <div class="guarantee-item">
              <img
                src="./assets/images/review/review-1.svg"
                alt="30 Day Money Back Guarantee"
              />
              <div>
                <h4>30 day money back guarantee</h4>
                <p>
                  Not happy? No problem. Get your money back within 30 days.
                </p>
              </div>
            </div>
            <div class="guarantee-item">
              <img
                src="./assets/images/review/review-2.svg"
                alt="Safe and Secure Payment"
              />
              <div>
                <h4>Safe and secure payment</h4>
                <p>Shop with confidenceâ€”your payment is always safe with us.</p>
              </div>
            </div>
          </div>

          <div class="reviews-wrapper">
            <div class="reviews" id="reviews">
              <div class="review">
                <div class="review-left">
                  <div class="name">Ga**by</div>
                  <div class="flag">ðŸ‡§ðŸ‡¬</div>
                  <div class="badge">CUSTOMER</div>
                </div>
                <div class="review-right">
                  <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                  <div class="text">
                    The best purchase I made this year. The product quality
                    exceeded my expectations and the delivery was incredibly
                    fast.
                  </div>
                  <div class="time">26 minutes ago</div>
                </div>
              </div>

              <div class="review">
                <div class="review-left">
                  <div class="name">Em**el</div>
                  <div class="flag">ðŸ‡¦ðŸ‡ª</div>
                  <div class="badge">CUSTOMER</div>
                </div>
                <div class="review-right">
                  <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                  <div class="text">
                    Never have I spent my money that well. Great service and
                    delivery...Guess I was lucky this time! See you next time
                  </div>
                  <div class="time">56 minutes ago</div>
                </div>
              </div>

              <div class="review">
                <div class="review-left">
                  <div class="name">Ko**st</div>
                  <div class="flag">ðŸ‡¬ðŸ‡§</div>
                  <div class="badge">CUSTOMER</div>
                </div>
                <div class="review-right">
                  <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                  <div class="text">
                    I received my product yesterday. Fast and outstanding
                    customer service! Thanks a lot &lt;3
                  </div>
                  <div class="time">2 hours ago</div>
                </div>
              </div>

              <div class="review">
                <div class="review-left">
                  <div class="name">Sa**ah</div>
                  <div class="flag">ðŸ‡ºðŸ‡¸</div>
                  <div class="badge">VIP CLIENT</div>
                </div>
                <div class="review-right">
                  <div class="stars">â˜…â˜…â˜…â˜…â˜…</div>
                  <div class="text">
                    This is my third purchase from this store and I'm
                    consistently impressed by the quality and customer service.
                  </div>
                  <div class="time">5 hours ago</div>
                </div>
              </div>
            </div>
          </div>

          <div class="live-notification">
            <div id="sales-notification-container"></div>
          </div>
        </div>
      </div>
    </section>
    <script src="./assets/js/app.js"></script>

    <script>
      const countries = [
        { code: "BD", name: "Bangladesh", flag: "ðŸ‡§ðŸ‡©", pCode: "+880" },
        { code: "IN", name: "India", flag: "ðŸ‡®ðŸ‡³", pCode: "+91" },
        {
          code: "US",
          name: "United States",
          flag: "ðŸ‡ºðŸ‡¸",
          pCode: "+1",
          states: [
            { code: "CA", name: "California" },
            { code: "NY", name: "New York" },
            { code: "TX", name: "Texas" },
            { code: "FL", name: "Florida" },
            { code: "IL", name: "Illinois" },
          ],
        },
        { code: "GB", name: "United Kingdom", flag: "ðŸ‡¬ðŸ‡§", pCode: "+44" },
        { code: "CA", name: "Canada", flag: "ðŸ‡¨ðŸ‡¦", pCode: "+1" },
        { code: "AU", name: "Australia", flag: "ðŸ‡¦ðŸ‡º", pCode: "+61" },
        { code: "BE", name: "Belgium", flag: "ðŸ‡§ðŸ‡ª", pCode: "+32" },
        { code: "BM", name: "Bermuda", flag: "ðŸ‡§ðŸ‡²", pCode: "+1" },
        { code: "BT", name: "Bhutan", flag: "ðŸ‡§ðŸ‡¹", pCode: "+975" },
        { code: "BR", name: "Brazil", flag: "ðŸ‡§ðŸ‡·", pCode: "+55" },
      ];

      const select = document.getElementById("country");
      const stateGroup = document.getElementById("state-group");
      const stateSelect = document.getElementById("state");
      const countrySelectEl = document.getElementById("country-select");
      const countryInput = document.getElementById("country-input");
      const countryPanelInner = document.getElementById("country-panel-inner");
      const countryList = document.getElementById("country-list");
      const stateSelectEl = document.getElementById("state-select");
      const stateInput = document.getElementById("state-input");
      const statePanelInner = document.getElementById("state-panel-inner");
      const stateList = document.getElementById("state-list");

      // Populate all countries (ISO 3166-1 alpha-2)
      const isoCountryCodes = [
        "AF",
        "AX",
        "AL",
        "DZ",
        "AS",
        "AD",
        "AO",
        "AI",
        "AQ",
        "AG",
        "AR",
        "AM",
        "AW",
        "AU",
        "AT",
        "AZ",
        "BS",
        "BH",
        "BD",
        "BB",
        "BY",
        "BE",
        "BZ",
        "BJ",
        "BM",
        "BT",
        "BO",
        "BQ",
        "BA",
        "BW",
        "BV",
        "BR",
        "IO",
        "BN",
        "BG",
        "BF",
        "BI",
        "CV",
        "KH",
        "CM",
        "CA",
        "KY",
        "CF",
        "TD",
        "CL",
        "CN",
        "CX",
        "CC",
        "CO",
        "KM",
        "CG",
        "CD",
        "CK",
        "CR",
        "CI",
        "HR",
        "CU",
        "CW",
        "CY",
        "CZ",
        "DK",
        "DJ",
        "DM",
        "DO",
        "EC",
        "EG",
        "SV",
        "GQ",
        "ER",
        "EE",
        "SZ",
        "ET",
        "FK",
        "FO",
        "FJ",
        "FI",
        "FR",
        "GF",
        "PF",
        "TF",
        "GA",
        "GM",
        "GE",
        "DE",
        "GH",
        "GI",
        "GR",
        "GL",
        "GD",
        "GP",
        "GU",
        "GT",
        "GG",
        "GN",
        "GW",
        "GY",
        "HT",
        "HM",
        "VA",
        "HN",
        "HK",
        "HU",
        "IS",
        "IN",
        "ID",
        "IR",
        "IQ",
        "IE",
        "IM",
        "IL",
        "IT",
        "JM",
        "JP",
        "JE",
        "JO",
        "KZ",
        "KE",
        "KI",
        "KP",
        "KR",
        "KW",
        "KG",
        "LA",
        "LV",
        "LB",
        "LS",
        "LR",
        "LY",
        "LI",
        "LT",
        "LU",
        "MO",
        "MG",
        "MW",
        "MY",
        "MV",
        "ML",
        "MT",
        "MH",
        "MQ",
        "MR",
        "MU",
        "YT",
        "MX",
        "FM",
        "MD",
        "MC",
        "MN",
        "ME",
        "MS",
        "MA",
        "MZ",
        "MM",
        "NA",
        "NR",
        "NP",
        "NL",
        "NC",
        "NZ",
        "NI",
        "NE",
        "NG",
        "NU",
        "NF",
        "MK",
        "MP",
        "NO",
        "OM",
        "PK",
        "PW",
        "PS",
        "PA",
        "PG",
        "PY",
        "PE",
        "PH",
        "PN",
        "PL",
        "PT",
        "PR",
        "QA",
        "RE",
        "RO",
        "RU",
        "RW",
        "BL",
        "SH",
        "KN",
        "LC",
        "MF",
        "PM",
        "VC",
        "WS",
        "SM",
        "ST",
        "SA",
        "SN",
        "RS",
        "SC",
        "SL",
        "SG",
        "SX",
        "SK",
        "SI",
        "SB",
        "SO",
        "ZA",
        "GS",
        "SS",
        "ES",
        "LK",
        "SD",
        "SR",
        "SJ",
        "SE",
        "CH",
        "SY",
        "TW",
        "TJ",
        "TZ",
        "TH",
        "TL",
        "TG",
        "TK",
        "TO",
        "TT",
        "TN",
        "TR",
        "TM",
        "TC",
        "TV",
        "UG",
        "UA",
        "AE",
        "GB",
        "US",
        "UM",
        "UY",
        "UZ",
        "VU",
        "VE",
        "VN",
        "VG",
        "VI",
        "WF",
        "EH",
        "YE",
        "ZM",
        "ZW",
      ];

      const regionNames = new Intl.DisplayNames(["en"], { type: "region" });
      function codeToFlag(code) {
        return code
          .toUpperCase()
          .replace(/./g, (char) =>
            String.fromCodePoint(char.charCodeAt(0) + 127397)
          );
      }

      // Clear existing options (keep placeholder via render function)
      select.innerHTML = "";

      const countryItems = isoCountryCodes.map((code) => ({
        code,
        name: regionNames.of(code) || code,
        flag: codeToFlag(code),
      }));

      function renderCountryOptions(list, preserveValue = true) {
        const previousValue = preserveValue ? select.value : "";
        select.innerHTML = "";
        const ph = document.createElement("option");
        ph.value = "";
        ph.hidden = true;
        ph.textContent = "Select country";
        select.appendChild(ph);

        list
          .slice()
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach((c) => {
            const option = document.createElement("option");
            option.value = c.code;
            option.textContent = `${c.flag} ${c.name}`;
            select.appendChild(option);
          });

        if (
          preserveValue &&
          previousValue &&
          list.some((c) => c.code === previousValue)
        ) {
          select.value = previousValue;
        } else {
          select.value = "";
          // Reset state if selection cleared
          if (typeof updateStateOptions === "function") updateStateOptions();
        }
      }

      // Initial render
      renderCountryOptions(countryItems, false);

      // Custom dropdown behavior (in-panel search)
      function openCountryPanel() {
        countryPanelInner.style.display = "block";
      }

      function closeCountryPanel() {
        countryPanelInner.style.display = "none";
        renderCountryList(countryItems);
      }

      function setSelectedCountry(code) {
        const item = countryItems.find((c) => c.code === code);
        if (!item) return;
        select.value = item.code;
        countryInput.value = `${item.flag} ${item.name}`;
        if (typeof updateStateOptions === "function") updateStateOptions();
      }

      function renderCountryList(list) {
        countryList.innerHTML = "";
        list
          .slice()
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach((c) => {
            const li = document.createElement("li");
            li.textContent = `${c.flag} ${c.name}`;
            li.setAttribute("data-code", c.code);
            li.style.padding = "8px 12px";
            li.style.cursor = "pointer";
            li.addEventListener("click", () => {
              setSelectedCountry(c.code);
              closeCountryPanel();
            });
            li.addEventListener(
              "mouseenter",
              () => (li.style.background = "#f7f7f7")
            );
            li.addEventListener(
              "mouseleave",
              () => (li.style.background = "transparent")
            );
            countryList.appendChild(li);
          });
      }

      // Initial custom list render and default display
      renderCountryList(countryItems);
      countryInput.addEventListener("focus", () => {
        const isOpen =
          countryPanelInner.style.display !== "none" &&
          countryPanelInner.style.display !== "";
        if (isOpen) {
          closeCountryPanel();
        } else {
          openCountryPanel();
        }
      });
      countryInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openCountryPanel();
        }
      });
      countryInput.addEventListener("input", () => {
        const q = countryInput.value.trim().toLowerCase();
        const filtered = q
          ? countryItems.filter(
              (c) =>
                c.name.toLowerCase().includes(q) ||
                c.code.toLowerCase().includes(q)
            )
          : countryItems;
        renderCountryList(filtered);
      });
      document.addEventListener("click", (e) => {
        if (!countrySelectEl.contains(e.target)) {
          closeCountryPanel();
        }
      });

      // Sync display if a selection exists
      if (select.value) {
        setSelectedCountry(select.value);
      }

      function updateStateOptions() {
        const selectedCode = select.value;
        const country = countries.find((c) => c.code === selectedCode);

        // reset state select
        stateSelect.innerHTML = "";
        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.hidden = true;
        placeholder.textContent = "Select state";
        stateSelect.appendChild(placeholder);

        if (country && Array.isArray(country.states) && country.states.length) {
          country.states.forEach((s) => {
            const opt = document.createElement("option");
            opt.value = s.code;
            opt.textContent = s.name;
            stateSelect.appendChild(opt);
          });
          stateGroup.style.display = "block";
          stateSelect.required = true;
          // Reset custom state input and list on country change
          stateInput.value = "";
          renderStateList(country.states);
        } else {
          stateGroup.style.display = "none";
          stateSelect.required = false;
          stateInput && (stateInput.value = "");
          stateList && (stateList.innerHTML = "");
        }
      }

      select.addEventListener("change", updateStateOptions);

      // State custom dropdown behavior
      function openStatePanel() {
        statePanelInner.style.display = "block";
      }

      function closeStatePanel() {
        statePanelInner.style.display = "none";
        const selectedCode = select.value;
        const country = countries.find((c) => c.code === selectedCode);
        const list =
          country && Array.isArray(country.states) ? country.states : [];
        renderStateList(list);
      }

      function setSelectedState(code) {
        const selectedCode = select.value;
        const country = countries.find((c) => c.code === selectedCode);
        if (!country || !Array.isArray(country.states)) return;
        const item = country.states.find((s) => s.code === code);
        if (!item) return;
        stateSelect.value = item.code;
        stateInput.value = item.name;
      }

      function renderStateList(list) {
        stateList.innerHTML = "";
        list
          .slice()
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach((s) => {
            const li = document.createElement("li");
            li.textContent = s.name;
            li.setAttribute("data-code", s.code);
            li.style.padding = "8px 12px";
            li.style.cursor = "pointer";
            li.addEventListener("click", () => {
              setSelectedState(s.code);
              closeStatePanel();
            });
            li.addEventListener(
              "mouseenter",
              () => (li.style.background = "#f7f7f7")
            );
            li.addEventListener(
              "mouseleave",
              () => (li.style.background = "transparent")
            );
            stateList.appendChild(li);
          });
      }

      stateInput &&
        stateInput.addEventListener("focus", () => {
          const isOpen =
            statePanelInner.style.display !== "none" &&
            statePanelInner.style.display !== "";
          if (isOpen) {
            closeStatePanel();
          } else {
            openStatePanel();
          }
        });
      stateInput &&
        stateInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openStatePanel();
          }
        });
      stateInput &&
        stateInput.addEventListener("input", () => {
          const q = stateInput.value.trim().toLowerCase();
          const selectedCode = select.value;
          const country = countries.find((c) => c.code === selectedCode);
          const list =
            country && Array.isArray(country.states) ? country.states : [];
          const filtered = q
            ? list.filter(
                (s) =>
                  s.name.toLowerCase().includes(q) ||
                  s.code.toLowerCase().includes(q)
              )
            : list;
          renderStateList(filtered);
        });
      document.addEventListener("click", (e) => {
        if (stateSelectEl && !stateSelectEl.contains(e.target)) {
          closeStatePanel();
        }
      });
    </script>
  </body>
</html>
